---
title: 第3节：按钮定义与事件实现
pay: https://t.zsxq.com/0fAo8tnHc
---

# 《ChatGPT 微服务应用体系构建》 - chagpt-web 第3节：按钮定义与事件实现

作者：小傅哥
<br/>博客：[https://bugstack.cn](https://bugstack.cn)

>沉淀、分享、成长，让自己和他人都能有所收获！😄

- **本章难度**：★★☆☆☆
- **本章重点**：通过引入按钮功能，实现页面的放大/缩小效果。因为有按钮的引入也会逐步添加一些基本的共用功能为后续的章节模块实现时进行使用。
- **课程视频**：[https://t.zsxq.com/0ftIpvAXH](https://t.zsxq.com/0ftIpvAXH)

## 一、本章诉求

做编程开发通常我们需要结果为导向，以终为始。知道自己的目标，再朝着目标不断的积累所需的物料能量。那么在本章中我们会以实现一个用于`放大/缩小`页面的按钮设计和实现，来完善整体 web-ui 所需基础设施模块。

可能在当下章节你会觉得实现功能并不大，代码量也不多。但要在前期这个学习阶段打好基础，因为所有前面所学习到的组件、模块、代码、设计，在后续都会被串联起来使用。所以前面一定打好基础，来保证后续的学习质量。

## 二、目标效果

虽然就是实现一个`按钮`看似功能很小，但因为引入一系列按钮，所以定义了通用按钮设计以及定义配置存储。当操作按钮时候可以从配置中设置和使用，这样整个界面就放大和缩小了。

<div align="center">
    <img src="https://bugstack.cn/images/article/project/chatgpt/chatgpt-web-03-01.png?raw=true" width="850px">
</div>

- 按钮是整个页面的一个小功能点，通过小功能点来引出 web-ui 整体架构中的各个模块实现。包括这里的配置存储，就是为后续整个配置设计的。
- 对于这样功能点的实现，会涉及到；按钮定义、CSS设计、TypeScript语法 `zustand#create、zustand/middleware#persist` 等。可能有有些伙伴对前端积累不多，可以对于各类小的细节点在 ChatGPT 中提问获取答案。

##  三、工程结构

本章新增加 `button` 和 `store#config.ts` 两部分，并在 `home.tsx`、`sidebar.tsx` 中使用。

<div align="center">
    <img src="https://bugstack.cn/images/article/project/chatgpt/chatgpt-web-03-02.png?raw=true" width="400px">
</div>

- 在 chatgpt-web `package.json` 中添加新的模块；`"zustand": "^4.3.6"`  - zustand 是一个状态管理库，它提供了一种简单的方式来管理 React 应用程序中的状态，可以方便地在应用程序的组件之间共享和更新状态。而 TypeScript 是一种静态类型检查器，它可以在开发过程中提供更好的代码提示和类型安全，有助于减少在运行时出现类型错误的可能性。
- button 按钮是定义的一个通用按钮，封了按钮的实现并可由外部传递样式、图标、文本和执行函数。本章中会介绍整体实现，具体的小的代码可以参考源码。

## 四、页面实现

### 1. 按钮设计

**源码**：`button.tsx`

```java
import styles from "./button.module.scss";

/**
 * 定义通用按钮函数 IconButton
 * @param props.onClick 按钮事件(可选)
 * @param props.icon 图标(可选)
 * @param props.className CSS 样式
 * @param props.title 图标名称
 * @param props.text 图标说明
 * */
export function IconButton(props: {
    onClick?: () => void;
    icon?: JSX.Element;
    className?: string;
    title?: string;
    text?: string;
    backgroundColor?: string;
}) {
    const {backgroundColor} = props;

    const buttonStyle = {
        backgroundColor: backgroundColor,
    };

    return (
        <button className={styles["icon-button"]} style={buttonStyle} onClick={props.onClick}>
            {props.icon && <div className={styles["icon-button-icon"]}>{props.icon}</div>}
            {props.text && <div className={styles["icon-button-text"]}>{props.text}</div>}
        </button>
    );
}
```

- 在前端代码实现中，通常会对一些通用的模块进行统一定义和使用，这样可以减少共性逻辑的开发。
- 这里我们正好有3个按钮都是这样一个处理，所以为了避免更多的重复代码的开发，这里设计了一个 IconButton 按钮。在按钮函数中定义入参和 return 方法。return 里封装的是 div 按钮，这里可以扩展使用函数属性和方法。**你可以尽量用 Java 的思想来理解这些内容**

### 2. 配置文件

**源码**：`config.ts`

```java
/**
 * 配置文件
 * @param tightBorder true/false 是否全框体展示
 */
export const DEFAULT_CONFIG = {
    tightBorder: false,
}

export type ChatConfig = typeof DEFAULT_CONFIG;

export type ChatConfigStore = ChatConfig & {
    reset: () => void;
    update: (updater: (config: ChatConfig) => void) => void;
};

/**
 * create 函数创建了一个 ChatConfigStore 实例，并且通过 export 关键字导出了一个名为 useAppConfig 的常量。
 * ChatConfigStore 可能是一个自定义的数据存储类，而 useAppConfig 是一个用于在 React 组件中访问和修改 ChatConfigStore 实例的自定义 Hook。
 */
export const useAppConfig = create<ChatConfigStore>()(
    persist(
        (set, get) => ({
            ...DEFAULT_CONFIG,

            reset() {
                set(() => ({...DEFAULT_CONFIG}));
            },

            update(updater) {
                const config = {...get()};
                updater(config);
                set(() => config);
            },
        }),
        {
            name: "app-config",
            version: 2,
            migrate(persistedState, version) {
                if (version === 2) return persistedState as any;
                return persistedState as ChatConfig;
            },
        },
    ),
);
```

- 我们需要实现一个点击按钮`放大和缩小`的操作，而这个放大和缩小需要设定一个配置属性 true/false 当点击按钮的时候变更属性信息。再由使用配置的框体 home.tsx 中 `<div className={`${config.tightBorder ? styles["tight-container"] : styles.container}`}>` 动态的设定对应的属性。这个属性会让页面`放大和缩小`。

### 3. 按钮事件

**源码**：`sidebar.tsx` - 使用按钮

```java
<div className={styles["action-button"]}>
    <IconButton icon={<ExitIcon/>} backgroundColor={"#ff4e4e"} onClick={() => {
        alert("尚未实现");
    }}/>
  
    <IconButton icon={<MinIcon/>} backgroundColor={"#f3c910"} onClick={() => {
        config.update(
            (config) => (config.tightBorder = false),
        );
    }}/>
  
    <IconButton icon={<MaxIcon/>} backgroundColor={"#04c204"} onClick={() => {
        config.update(
            (config) => (config.tightBorder = true),
        );
    }}/>
</div>
```

**源码**：`home.tsx` - 样式变更

```java
function Screen() {
    const config = useAppConfig();
    return (
        <div className={`${config.tightBorder ? styles["tight-container"] : styles.container}`}>
            {/* 工具菜单 */}
            <SideBar/>

            {/* 路由地址 */}
            <div className={styles["window-content"]}>
                <Routes>
                    <Route path={Path.Home} element={<Chat/>}/>
                    <Route path={Path.Chat} element={<Chat/>}/>
                    <Route path={Path.Role} element={<Role/>}/>
                </Routes>
            </div>
        </div>
    );
}
```

- 有了通用按钮的设计，这里就可以非常方便的使用了。IconButton 设定 icon、backgroundColor、onClick 分别是`红、黄、绿`三个按钮。
- onClick 点击按钮的时候设置 config.tightBorder = false/true 就可以变化样式了。
- 在 div 中修改为动态的设置 className `<div className={`${config.tightBorder ? styles["tight-container"] : styles.container}`}>` - 读者可以细致看下两个 css 样式，变化的时候就是在切换这2个样式。

## 五、启动程序

如图所示，启动程序。你也可以在编程的过程中一直启动着程序，这样可以随着编写实时看到效果。

<div align="center">
    <img src="https://bugstack.cn/images/article/project/chatgpt/chatgpt-web-03-03.png?raw=true" width="350px">
</div>

```java
> chatgpt-web@0.1.0 dev
> next dev

- ready started server on 0.0.0.0:3000, url: http://localhost:3001
- event compiled client and server successfully in 1038 ms (306 modules)
```

<div align="center">
    <img src="https://bugstack.cn/images/article/project/chatgpt/chatgpt-web-03-04.png?raw=true" width="750px">
</div>

- 访问地址：[http://localhost:3000](http://localhost:3000) - 如果你启动多个，端口可能会是 3001、3002 注意。
- 鼠标滑动展示按钮列表，这个是mac电脑的效果。使用起来还不错，样式也不丑。就设计到这里了。

## 六、读者作业

- 简单作业：通过学习参考课程代码，编写自己的工程代码，不要完全复制。
- 复杂作业：如果你有一些前端的基础，可以根据这些内容，设定其他样式的展示。也可以在侧边栏最下面添加一个⚙**设置**齿轮的的按钮。